(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{19:function(e,t,n){e.exports=n(33)},24:function(e,t,n){},26:function(e,t,n){},33:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),o=n(16),a=n.n(o),l=(n(24),n(1)),s=n(2),c=n(5),u=n(3),v=n(4),d=(n(26),n(6)),h=n(10),f=function(e){return{type:"NEW_GAME",text:e}},g=function(e){return{type:"VISIT_VERTEX",id:e}},p=function(e){return{type:"RESET_LEVEL",id:e}},m=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.tile,n=e.tileState,r=e.tileSize,o=e.edgeSize,a=["tile",t.tileType,n.valid?" valid":" invalid"];return t.symbol&&(a.push("symbol"),a.push("symbol-"+t.symbol)),i.a.createElement("div",{className:a.join(" "),style:{width:r,height:r,left:t.x1*(r+o),top:t.y1*(r+o),color:t.color||"black"}})}}]),t}(r.Component),b=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.edge,n=e.edgeState,r=e.tileSize,o=e.edgeSize;return t.x1===t.x2?i.a.createElement("div",{className:"edge vertical"+(n.visited?" visited":"")+(t.broken?" broken":""),style:{width:o,height:r,left:t.x1*(r+o)-o,top:t.y1*(r+o)}}):i.a.createElement("div",{className:"edge horizontal"+(n.visited?" visited":"")+(t.broken?" broken":""),style:{width:r,height:o,left:t.x1*(r+o),top:t.y1*(r+o)-o}})}}]),t}(r.Component),y=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.vertex,n=e.vertexState,r=e.tileSize,o=e.edgeSize;return"entry"===t.vertexType?i.a.createElement("div",{className:"vertex "+(t.vertexType||"")+(n.visited?" visited":""),style:{width:3*o,height:3*o,left:t.x*(r+o)-o-o,top:t.y*(r+o)-o-o}}):"exit"===t.vertexType?i.a.createElement("div",{className:"vertex "+(t.vertexType||"")+(n.visited?" visited":""),style:{width:3*o,height:3*o,left:t.x*(r+o)-o-o,top:t.y*(r+o)-o-o}}):i.a.createElement("div",{className:"vertex "+(t.vertexType||"")+(n.visited?" visited":""),style:{width:o,height:o,left:t.x*(r+o)-o,top:t.y*(r+o)-o}})}}]),t}(r.Component),M=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).onMouseDown=e.onMouseDown.bind(Object(d.a)(Object(d.a)(e))),e.onMouseMove=e.onMouseMove.bind(Object(d.a)(Object(d.a)(e))),e.onMouseUp=e.onMouseUp.bind(Object(d.a)(Object(d.a)(e))),e.state={},e.dragging=!1,e}return Object(v.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.div.addEventListener("touchstart",this.onMouseDown),this.div.addEventListener("touchmove",this.onMouseMove,{passive:!1}),this.div.addEventListener("touchend",this.onMouseUp)}},{key:"onMouseDown",value:function(e){this.dragging=!0}},{key:"onMouseMove",value:function(e){if(this.dragging){var t,n,r=this.props,i=r.level,o=r.visitVertex,a=r.tileSize,l=r.edgeSize;if(e.targetTouches?(t=e.targetTouches[0],n=e.target,e.preventDefault()):(t=e.nativeEvent,n=e.nativeEvent.target),t&&n){var s=t.clientX-n.offsetLeft,c=t.clientY-n.offsetTop,u=Math.round(s/(a+l))-1,v=Math.round(c/(a+l))-1;if(console.log(s+", "+c+" => "+u+", "+v),u>=0&&v>=0&&v<=i.rows&&u<=i.cols)o(v*(i.cols+1)+u)}}}},{key:"onMouseUp",value:function(e){if(this.dragging){this.dragging=!1;var t,n,r=this.props,i=r.level,o=r.visitVertex,a=r.tileSize,l=r.edgeSize;if(e.targetTouches?(t=e.targetTouches[0],n=e.target):(t=e.nativeEvent,n=e.nativeEvent.target),t&&n){var s=t.clientX-n.offsetLeft,c=t.clientY-n.offsetTop,u=Math.round(s/(a+l))-1,v=Math.round(c/(a+l))-1;if(console.log(s+", "+c+" => "+u+", "+v),u>=0&&v>=0&&v<=i.rows&&u<=i.cols)o(v*(i.cols+1)+u)}}}},{key:"render",value:function(){var e=this,t=this.props,n=t.level,r=t.tileSize,o=t.edgeSize,a=t.boardSize,l=t.vMargin,s=t.hMargin;if(n&&n.tiles&&n.tiles[0]){var c=null;return n.completed&&!n.won?c=i.a.createElement("div",{className:"boardOverlay"}):n.completed&&n.won&&(c=i.a.createElement("div",{className:"boardOverlay"})),i.a.createElement("div",{className:"board "+(n.completed?" completed":"")+(n.won?" won":""),ref:function(t){return e.div=t},onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp,style:{marginTop:l,marginBottom:l,marginLeft:s,marginRight:s,width:a,height:a}},n.tiles.map(function(e,t){return i.a.createElement(m,{key:t,tile:e,tileState:n.tileState[t],tileSize:r,edgeSize:o})}),n.edges.map(function(e,t){return i.a.createElement(b,{key:t,edge:e,edgeId:t,edgeState:n.edgeState[t],tileSize:r,edgeSize:o})}),n.vertices.map(function(e,t){return i.a.createElement(y,{key:t,vertex:e,vertexId:t,vertexState:n.vertexState[t],tileSize:r,edgeSize:o})}),c)}return i.a.createElement("div",{className:"board"},"No game loaded;")}}]),t}(r.Component),x=Object(h.b)(function(e){return{}},function(e){return{resetLevel:function(t){return e(p(t))},newGame:function(t){return e(f(t))},visitVertex:function(t){return e(g(t))}}})(M),S=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={tileSize:50,edgeSize:10},e.updateSize=e.updateSize.bind(Object(d.a)(Object(d.a)(e))),e}return Object(v.a)(t,e),Object(s.a)(t,[{key:"updateSize",value:function(){if(this.div){var e=this.div.getBoundingClientRect();console.log(e);var t=Math.min(e.width,e.height)-20,n=t/60,r=t/(this.props.level.cols+2)-n;this.setState({boardSize:t,vMargin:(e.height-t)/2,hMargin:(e.width-t)/2,tileSize:r,edgeSize:n})}}},{key:"componentDidMount",value:function(){this.updateSize(),window.addEventListener("resize",this.updateSize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateSize)}},{key:"render",value:function(){var e=this,t=this.state,n=t.level,r=t.prevLevel,o=t.nextLevel,a=t.tileSize,l=t.edgeSize,s=t.boardSize,c=t.vMargin,u=t.hMargin;return i.a.createElement("div",{className:"boardcontainer",ref:function(t){return e.div=t},onClick:this.onClick},r?i.a.createElement("div",{className:"prevLevel"},i.a.createElement(x,Object.assign({level:r},{tileSize:a,edgeSize:l,boardSize:s,vMargin:c,hMargin:u}))):null,n?i.a.createElement("div",{className:"currentLevel"},i.a.createElement(x,Object.assign({level:n},{tileSize:a,edgeSize:l,boardSize:s,vMargin:c,hMargin:u}))):null,o?i.a.createElement("div",{className:"nextLevel"},i.a.createElement(x,Object.assign({level:o},{tileSize:a,edgeSize:l,boardSize:s,vMargin:c,hMargin:u}))):null)}}],[{key:"getDerivedStateFromProps",value:function(e,t){return t.level&&e.level?t.level&&e.level&&t.level.levelId!==e.level.levelId?(console.log("resetting"),{nextLevel:e.level,level:null,prevLevel:t.level}):(!t.level.completed&&e.level.completed&&(e.level.won?setTimeout(function(){return e.newGame()},500):setTimeout(function(){return e.resetLevel()},1e3)),{nextLevel:null,level:e.level,prevLevel:null}):{nextLevel:null,level:e.level,prevLevel:null}}}]),t}(r.Component),O=Object(h.b)(function(e){return{level:e.level}},function(e){return{resetLevel:function(t){return e(p(t))},newGame:function(t){return e(f(t))},visitVertex:function(t){return e(g(t))}}})(S),j=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"App",style:{}},i.a.createElement(O,null))}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var w=n(9),E=n(8),z=n(11),k={blank:{validate:function(){return!0}},paired:{place:function(e,t){console.log("placing paired tiles");for(var n=["black","white","orange","blue","green","purple","yellow"].map(function(e){return[Math.random(),e]}).sort(function(e,t){return e[0]-t[0]}).map(function(e){return e[1]}),r=Math.min(n.length,Math.floor(Math.random()*(e.length-2)+2)),i=function(r){for(var i=n[r],o=Object(z.a)(e.keys()).filter(function(n){var r=e[n];return!r.some(function(e){return"paired"===t[e].tileType&&t[e].color===i})&&!(r.filter(function(e){return"blank"===t[e].tileType}).length<2)}),a=Math.min(o.length,Math.floor(Math.random()*(e.length-2)+2)),l=0;l<a;l++)if(0!==o.length){var s=Math.floor(Math.random()*o.length),c=o[s];o.splice(s,1);for(var u=e[c],v=0;v<2;v++){var d=u.filter(function(e){return"blank"===t[e].tileType}),h=t[d[Math.floor(Math.random()*d.length)]];h.tileType="paired",h.color=i,h.symbol="diamond"}}},o=0;o<r;o++)i(o)},validate:function(e,t,n,r){var i=n[e];return 2===t.filter(function(e){var t=n[e];return i.tileType===t.tileType&&i.color===t.color}).length}},sameColor:{place:function(e,t){console.log("placing sameColor tiles");var n=["black","white","orange","blue","green","purple","yellow"].map(function(e){return[Math.random(),e]}).sort(function(e,t){return e[0]-t[0]}).map(function(e){return e[1]}),r=Math.min(n.length,Math.floor(Math.random()*(e.length-2)+2));console.log("placing sameColor tiles - "+r);for(var i=Object(z.a)(e.keys()),o=0;o<r;o++){var a=Math.floor(Math.random()*i.length),l=i[a];i.splice(a,1);for(var s=e[l],c=Math.ceil(s.length/2),u=Math.floor(Math.random()*(c-1)+1),v=0;v<u;v++){var d=t[s[Math.floor(Math.random()*s.length)]];"blank"===d.tileType&&(d.tileType="sameColor",d.color=n[o],d.symbol="drop")}}},validate:function(e,t,n,r){var i=n[e],o=t.filter(function(t){if(t===e)return!1;var r=n[t];return i.tileType===r.tileType&&i.color!==r.color});return o.length>0&&(console.log("failed on tile "+e),console.log(i),console.log(t),console.log(o),console.log(n[o[0]])),0===o.length}}};function T(e,t){return t.filter(function(t,n){return!(t.vertices.length<2)&&(t.vertices[0]===e||t.vertices[1]===e)}).map(function(t,n){return t.vertices[0]===e?t.vertices[1]:t.vertices[0]})}function L(e,t){for(var n=[],r=0;r<t.length;r++){var i=e.indexOf(t[r].vertices[0]),o=e.indexOf(t[r].vertices[1]);i>=0&&o>=0&&1===Math.abs(o-i)&&n.push(r)}return n}function N(e,t,n,r,i,o){n.splice(n.indexOf(e),1),t.push(e);var a=i.filter(function(t,r){if(t.tiles.length<2)return!1;if(o.indexOf(r)>=0)return!1;var i;if(t.tiles[0]===e)i=t.tiles[1];else{if(t.tiles[1]!==e)return!1;i=t.tiles[0]}return!(n.indexOf(i)<0)}).map(function(t,n){return t.tiles[0]===e?t.tiles[1]:t.tiles[0]}),l=!0,s=!1,c=void 0;try{for(var u,v=a[Symbol.iterator]();!(l=(u=v.next()).done);l=!0){var d=u.value;n.indexOf(d)<0||N(d,t,n,r,i,o)}}catch(h){s=!0,c=h}finally{try{l||null==v.return||v.return()}finally{if(s)throw c}}}function C(e,t,n){for(var r=e.map(function(e,t){return t}),i=[];r.length>0;){var o=[];N(r[0],o,r,e,t,n),i.push(o)}return i}function I(e,t){for(var n={name:"Generated Level",levelId:Math.floor(1e7*Math.random()),rows:e,cols:t,tiles:[],edges:[],vertices:[],path:[],completed:!1,won:!1},r=0;r<=e;r++)for(var i=0;i<=t;i++){var o={x:i+1,y:r+1,vertexType:"standard"};n.vertices.push(o)}for(var a=0;a<=e;a++){for(var l=0;l<t;l++){var s={x1:l+1,y1:a+1,x2:l+2,y2:a+1,broken:!1,tiles:[],vertices:[a*(t+1)+l,a*(t+1)+l+1]};a>0&&s.tiles.push((a-1)*t+l),a<e&&s.tiles.push(a*t+l),n.edges.push(s)}if(a<e)for(var c=0;c<=t;c++){var u={x1:c+1,y1:a+1,x2:c+1,y2:a+2,broken:!1,tiles:[],vertices:[a*(t+1)+c,(a+1)*(t+1)+c]};c>0&&u.tiles.push(a*t+c-1),c<t&&u.tiles.push(a*t+c),n.edges.push(u)}}for(var v=0;v<e;v++)for(var d=0;d<t;d++){var h={tileType:"blank",x1:d+1,y1:v+1,x2:d+2,y2:v+2};n.tiles.push(h)}for(var f=0;f<n.vertices.length;f++)n.vertices[f].neighbours=T(f,n.edges);for(var g=[Math.floor((e+1)*(t+1)-t/2-1)],p=0;p<g.length;p++)n.vertices[g[p]].vertexType="entry";for(var m=[Math.floor(t/2)],b=0;b<m.length;b++)n.vertices[m[b]].vertexType="exit";for(var y=function e(t,n,r,i){if("exit"===n[t[t.length-1]].vertexType){var o=L(t,r),a={path:t,length:t.length,regions:C(i,r,o),edges:o};return a.regions.length<4?null:a}var l=n[t[t.length-1]].neighbours.filter(function(e){return t.indexOf(e)<0});if(0===l.length)return null;for(var s,c=Math.random()>.5&&t.length>1;!c&&!s;){var u=l[Math.floor(Math.random()*l.length)];if(s=e(Object(z.a)(t).concat([u]),n,r,i))return s;c=Math.random()>.5&&t.length>1}return null}([g[0]],n.vertices,n.edges,n.tiles),M=0;M<y.regions.length;M++)for(var x=0;x<y.regions[M].length;x++)n.tiles[y.regions[M][x]].solutionRegion=M;for(var S=Math.floor(15*Math.random()+5),O=0;O<S;O++){var j=Math.floor(Math.random()*n.edges.length);y.edges.indexOf(j)>=0||(console.log("breaking edge "+j),n.edges[j].broken=!0)}for(var w=["paired","sameColor"],E=0;E<w.length;E++){k[w[E]].place(y.regions,n.tiles)}return n.edgeState=n.edges.map(function(e){return{visited:!1}}),n.vertexState=n.vertices.map(function(e){return{visited:!1}}),n.tileState=n.tiles.map(function(e){return{valid:!0}}),n.regions=[n.tiles.map(function(e,t){return t})],n.vertexState[g[0]].visited=!0,n.path=[g[0]],n.solution=y,n.entries=g,n.exits=m,n}var D={level:Object(E.a)({},I(6,6))},V=Object(w.b)({level:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D.level,t=arguments.length>1?arguments[1]:void 0;switch(console.log(t.type),t.type){case"NEW_GAME":return Object(E.a)({},e,I(6,6));case"RESET_LEVEL":return Object(E.a)({},e,{edgeState:e.edges.map(function(e){return{visited:!1}}),vertexState:e.vertices.map(function(t,n){return{visited:n===e.entries[0]}}),tileState:e.tiles.map(function(e){return{valid:!0}}),regions:[e.tiles.map(function(e,t){return t})],path:[e.entries[0]],completed:!1,won:!1});case"VISIT_VERTEX":console.log(t.type),console.log(t.id);var n=t.id,r=Object(z.a)(e.vertexState);r[n]=Object(E.a)({},r[n]);var i=e.vertices[n],o=Object(z.a)(e.path),a=!1,l=!1;if(!i)return e;if(e.completed)return e;var s=o[o.length-1],c=o[o.length-2],u=e.edges.findIndex(function(e){return e.vertices.indexOf(n)>=0&&e.vertices.indexOf(s)>=0&&!e.broken}),v=e.edges[u];if(console.log("Found edge "+u),console.log(v),0===o.length&&"entry"!==i.vertexType)return e;if(1===o.length&&"entry"===i.vertexType)o=[n],(r=e.vertices.map(function(e){return{visited:!1}}))[n].visited=!0;else if("entry"!==i.vertexType||v)if(n===c)r[o.pop()]={visited:!1};else{if(r[n].visited)return e;if(o.length>0&&!v)return e;r[n].visited=!0,o.push(n),"exit"===i.vertexType&&(a=!0)}else o=[n],(r=e.vertices.map(function(e){return{visited:!1}}))[n].visited=!0;var d=L(o,e.edges),h=e.edgeState.map(function(e,t){return d.indexOf(t)>=0?{visited:!0}:{visited:!1}}),f=C(e.tiles,e.edges,d);l=!0;for(var g=e.tiles.map(function(t,n){return Object(E.a)({},e.tileState[n],{valid:!0})}),p=0;p<f.length;p++){var m=!0,b=!1,y=void 0;try{for(var M,x=f[p][Symbol.iterator]();!(m=(M=x.next()).done);m=!0){var S=M.value;g[S].region=p;var O=k[e.tiles[S].tileType].validate(S,f[p],e.tiles,g);O||(l=!1),g[S].valid=O}}catch(j){b=!0,y=j}finally{try{m||null==x.return||x.return()}finally{if(b)throw y}}}return Object(E.a)({},e,{vertexState:r,edgeState:h,tileState:g,path:o,completed:a,won:l,regions:f});default:return e}}}),R=Object(w.c)(V);a.a.render(i.a.createElement(h.a,{store:R},i.a.createElement(j,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[19,2,1]]]);
//# sourceMappingURL=main.a7f2a7a8.chunk.js.map